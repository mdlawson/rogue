(function(){var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};window.demoCon={},demoCon.History=function(_super){function History(){return History.__super__.constructor.apply(this,arguments)}return __extends(History,_super),History.prototype.defaults={history:[]},History.prototype.initialize=function(){return _.bindAll(this),this.evaluator=this.js,this.fetch(),this.bind("destroy",function(e){return e.set({history:[]})})},History.prototype.localStorage=new Backbone.LocalStorage("DemoConsole"),History.prototype.parse=function(e){return!_.isArray(e)||e.length<1||!e[0]?e:(e[0].history=_.map(e[0].history,function(e){return e._hidden=!0,e.result&&delete e.result,e._class&&delete e._class,e}),e[0])},History.prototype.stringify=function(e,t,n){var r,i,s,o,u,a,f;s="",i=void 0,f=void 0,a="",u=[],o=[],r=!1,n=n||[];try{a={}.toString.call(e)}catch(l){a="[object Object]"}f=0;while(f<n.length){if(e===n[f]){r=!0;break}f++}if(r)s="[circular]";else if(a==="[object String]")s='"'+e.replace(/"/g,'\\"')+'"';else if(a==="[object Array]"){n.push(e),s="[",i=0;while(i<e.length)u.push(this.stringify(e[i],t,n)),i++;s+=u.join(", ")+"]",s}else if(a==="[object Object]"){n.push(e),s="{";for(i in e)o.push(i);o.sort(sortci),i=0;while(i<o.length)u.push(this.stringify(o[i],undefined,n)+": "+this.stringify(e[o[i]],t,n)),i++;s+=u.join(", ")+"}"}else if(a==="[object Number]")s=e+"";else if(a==="[object Boolean]")s=e?"true":"false";else if(a==="[object Function]")s=e.toString();else if(e===null)s="null";else if(e===undefined)s="undefined";else if(t===undefined){n.push(e),s=a+"{\n";for(i in e)o.push(i);o.sort(sortci),i=0;while(i<o.length){try{u.push(o[i]+": "+this.stringify(e[o[i]],!0,n))}catch(l){l.name==="NS_ERROR_NOT_IMPLEMENTED"}i++}s+=u.join(",\n")+"\n}"}else try{s=e+""}catch(c){}return s},History.prototype.addHistory=function(e){var t;return t=this.get("history"),_.isString(e.result)&&(e.result='"'+e.result.toString().replace(/"/g,'\\"')+'"'),_.isFunction(e.result)&&(e.result=e.result.toString().replace(/"/g,'\\"')),_.isObject(e.result)&&(e.result=this.stringify(e.result).replace(/"/g,'\\"')),_.isUndefined(e.result)&&(e.result="undefined"),t.push(e),this.save({history:t}),this.trigger("change",this,t),this},History.prototype.load=function(e){var t;return t=document.createElement("script"),t.type="text/javascript",t.src=e,document.body.appendChild(t)},History.prototype.evaluate=function(e){var t;if(!e)return!1;t={command:e};try{t.result=this.evaluator(e),_.isUndefined(t.result)&&(t._class="undefined"),_.isNumber(t.result)&&(t._class="number"),_.isString(t.result)&&(t._class="string")}catch(n){t.result=n.toString(),t._class="error"}return this.addHistory(t)},History.prototype.js=function(command){return eval.call(window,command)},History.prototype.coffee=function(e){return CoffeeScript.eval.call(window,e)},History}(Backbone.Model),demoCon.View=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.initialize=function(e){return _.bindAll(this),this.model=new demoCon.History,this.historyState=this.model.get("history").length,this.currentHistory="",this.resultPrefix=e.resultPrefix||"  => ",this.tabCharacter=e.tabCharacter||"	",this.placeholder=e.placeholder||"// type some javascript and hit enter (:help for info)",this.helpText=e.helpText||"type javascript commands into the console, hit enter to evaluate. \n[up/down] to scroll through history, ':clear' to reset it. \n[alt + return/up/down] for returns and multi-line editing.\n':coffee' tells the console to evaluate input as coffeescript,\n':js' tells it you are using js again",this.model.bind("change",this.update),this.render()},t.prototype.events={"keydown textarea":"keyDown","keyup textarea":"keyUp","click .output":"focus"},t.prototype.template=_.template($("#tplSandbox").html()),t.prototype.format=_.template($("#tplCommand").html()),t.prototype.render=function(){var e;return e=$(this.el),e.html(this.template({placeholder:this.placeholder})),this.textarea=e.find("textarea"),this.output=e.find(".output"),this},t.prototype.update=function(){return this.output.html(_.reduce(this.model.get("history"),function(e,t){return e+this.format({_hidden:t._hidden,_class:t._class,command:this.toEscaped(t.command),result:this.toEscaped(t.result)})},"",this)),this.textarea.val(this.currentHistory).attr("rows",this.currentHistory.split("\n").length),this.output.scrollTop(this.output[0].scrollHeight-this.output.height())},t.prototype.setValue=function(e){return this.currentHistory=e,this.update(),this.setCaret(this.textarea.val().length),this.textarea.focus(),!1},t.prototype.getCaret=function(){return this.textarea[0].selectionStart?this.textarea[0].selectionStart:0},t.prototype.setCaret=function(e){return this.textarea[0].selectionStart=e,this.textarea[0].selectionEnd=e},t.prototype.toEscaped=function(e){return String(e).replace(/\\"/g,'"').replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},t.prototype.focus=function(e){return e.preventDefault(),this.textarea.focus(),!1},t.prototype.keyDown=function(e){var t,n,r,i,s,o;_([16,17,18]).indexOf(e.which,!0)>-1&&(this.ctrl=!0);if(e.which===13)return e.preventDefault(),s=this.textarea.val(),this.ctrl?(this.currentHistory=s+"\n",this.update(),!1):(this.currentHistory="",this.specialCommands(s)||this.model.evaluate(s),this.historyState=this.model.get("history").length,!1);if(!this.ctrl&&(e.which===38||e.which===40))return e.preventDefault(),r=this.model.get("history"),n=e.which-39,this.historyState+=n,this.historyState<0?this.historyState=0:this.historyState>=r.length&&(this.historyState=r.length),this.currentHistory=r[this.historyState]?r[this.historyState].command:"",this.update(),!1;if(e.which===9)return e.preventDefault(),o=this.textarea.val(),t=this.getCaret(),i=[o.slice(0,t),o.slice(t,o.length)],this.textarea.val(i[0]+this.tabCharacter+i[1]),this.setCaret(t+this.tabCharacter.length),!1},t.prototype.keyUp=function(e){if(_([16,17,18]).indexOf(e.which,!0)>-1)return this.ctrl=!1},t.prototype.specialCommands=function(e){return e===":clear"?(this.model.destroy(),!0):e===":help"?this.model.addHistory({command:":help",result:this.helpText}):e===":coffee"?(this.model.evaluator=this.model.coffee,this.placeholder="# type some coffeescript and hit enter (:help for info)",this.render(),this.model.addHistory({command:":coffee",result:"Input is now evaluated as CoffeeScript"})):e===":js"?(this.model.evaluator=this.model.js,this.placeholder="// type some javascript and hit enter (:help for info)",this.render(),this.model.addHistory({command:":js",result:"Input is now evaluated as JavaScript"})):e.indexOf(":load")>-1?this.model.addHistory({command:e,result:this.model.load(e.substring(6))}):!1},t}(Backbone.View)}).call(this)