// Generated by CoffeeScript 1.3.3
(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},C={}.hasOwnProperty,k=function(e,t){function r(){this.constructor=e}for(var n in t)C.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},L=function(e,t){return function(){return e.apply(t,arguments)}},A=[].slice;g={},g.scale=function(e,t,n){var r,i;return i=x.canvas(),i.width=e.width*t[0],i.height=e.height*t[1],r=i.getContext("2d"),r.scale(t[0],t[1]),n?r.mozImageSmoothingEnabled!=null?(r.mozImageSmoothingEnabled=!1,r.imageSmoothingEnabled=!1,r.drawImage(e,0,0,e.width,e.height)):(r.fillStyle=r.createPattern(e,"repeat"),r.fillRect(0,0,e.width,e.height)):r.drawImage(e,0,0,e.width,e.height),i},g.edit=function(e,t,n,r,i,s,o){var u,a;return u=e.data,a=(n*e.width+t)*4,r||i||s||o?(u[a]=r||0,u[a++]=i||0,u[a++]=s||0,u[a++]=o||0,e.data=u):[u[a],u[a++],u[a++],u[a++]]},g.edgeDetect=function(e){var t,n,r,i,s,o,u,a,f,l;t=e.getContext("2d"),n=t.getImageData(0,0,e.width,e.height),r=function(e,t){return g.edit(n,e,t)[3]},i=[];for(s=u=0,f=e.width;0<=f?u<=f:u>=f;s=0<=f?++u:--u)for(o=a=0,l=e.height;0<=l?a<=l:a>=l;o=0<=l?++a:--a)r(s,o)>0&&(r(s+1,o)===0?i.push([s,o,"right"]):r(s-1,o)===0?i.push([s,o,"left"]):r(s,o+1)===0?i.push([s,o,"down"]):r(s,o-1)===0&&i.push([s,o,"up"]));return i},t=function(){function r(e){var t,n,r;this.callbacks={load:{},complete:{},error:{}},this.base=e.baseUrl||"",this.packs={},this.total=this.complete=0,r=e.packs;for(n in r)t=r[n],this.packs[n]=t,this.total+=t.length;e.preload&&this.downloadAll()}var e,t,n;return r.prototype.download=function(r){var i,s,o,u,a,f,l,c,h;f=this,s=this.packs[r];if(s==null)return b(2,"Pack "+r+" does not exist"),!1;if(s.loaded!==s.length){s.loaded=0;for(c=0,h=s.length;c<h;c++){i=s[c],u=i.src.split(".").pop(),i.src=this.base+i.src,i.pack=r;for(a in n)l=n[a],N.call(l,u)>=0&&(i.type=a);if(i.type==null)return b(2,"Unknown asset type for extension: "+u),!1;switch(i.type){case"image":o=new Image,o.a=i,o.onload=function(){var e,t;return t=x.imgToCanvas(this),e=x.mixin(t,this.a),f.loaded(e)},o.onerror=function(){return e.call(f,this.a,!1)},o.src=i.src;break;case"sound":i.alt=this.base+i.alt,o=new Audio,o.preload="none",i=x.mixin(o,i),o.canPlayType(t[u])||(i.src=i.alt),i.onerror=function(){return e.call(f,i,!1)},i.addEventListener("canplaythrough",function(){return f.loaded(this)}),i.load()}}}},r.prototype.loaded=function(t){var n,r,i;return n=this.packs[t.pack],(i=this[r=t.pack])==null&&(this[r]={}),this[t.pack][t.name]=t,e.call(this,t,!0)},r.prototype.downloadAll=function(){var e,t,n,r;n=this.packs,r=[];for(e in n)t=n[e],r.push(this.download(e));return r},r.prototype.on=function(e,t,n){var r,i,s,o;if(e==="load"||e==="complete"||e==="error")return t==="all"?((s=this[i="on"+e])==null&&(this[i]=[]),this["on"+e].push(n)):((o=(r=this.callbacks[e])[t])==null&&(r[t]=[]),this.callbacks[e][t].push(n))},e=function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p;o=this.packs[e.pack],u=w.round(++o.loaded/o.length*100),r=w.round(++this.complete/this.total*100),s=[],n=[],t?a="load":"error",s=s.concat(this.callbacks[a][e.pack]),n=n.concat(this["on"+a]),u===100&&(s=s.concat(this.callbacks.complete[e.pack])),r===100&&(n=n.concat(this.oncomplete));for(f=0,c=s.length;f<c;f++)i=s[f],i&&i(e,u);p=[];for(l=0,h=n.length;l<h;l++)i=n[l],i&&p.push(i(e,r));return p},n={image:["png","gif","jpg","jpeg","tiff"],sound:["mp3","ogg"]},t={mp3:"audio/mpeg",ogg:"audio/ogg"},r}(),f=function(){function e(e){var t,n,r,i,s,o,u,a,f,l;this.options=e,this.img=this.options.image,this.res=this.options.res||[32,32],this.length=0;for(r=s=0,u=this.img.width,a=this.res[0];0<=u?s<u:s>u;r=s+=a)for(i=o=0,f=this.img.height,l=this.res[1];0<=f?o<f:o>f;i=o+=l)t=x.canvas(),n=t.getContext("2d"),t.width=this.res[0],t.height=this.res[1],n.drawImage(this.img,r,i,t.width,t.height,0,0,t.width,t.height),this[this.length]=t,this.length++}return e.prototype.slice=function(e,t){return Array.prototype.slice.call(this,e,t)},e}(),e=function(){function e(e){this.options=e,this.sprites=this.options.spritesheet,this.speed=this.options.speed||6,this.i=this.options.start||0,this.t=0,this.loop=this.options.loop||!0,this.bounce=this.options.bounce||!1,this.onFinish=this.options.onFinish,this.dir=1,this.frame=this.sprites[this.i]}return e.prototype.next=function(){return this.t===this.speed&&(this.frame=this.sprites[this.i+=this.dir],this.t=0),this.i===this.sprites.length-1&&(this.loop?this.bounce?this.dir=-1:this.i=0:this.onFinish&&this.onFinish()),this.i===0&&this.dir===-1&&(this.dir=1),this.t++,this.frame},e}(),n=function(){function e(e){this.options=e,this.components=[],this.updates=[],x.mixin(this,this.options),x.eventer(this),this.require&&this["import"](this.require),delete this.require,this.parent&&this.parent.e.push(this)}return e.prototype["import"]=function(e){var t,n,r,i;e=[].concat(e),i=[];for(n=0,r=e.length;n<r;n++)t=e[n],N.call(this.components,t)<0?(this.components.push(t),x.mixin(this,new u.components[t]),this.init!=null&&this.init(),i.push(delete this.init)):i.push(void 0);return i},e.prototype.update=function(e){var t,n,r,i,s;i=this.updates,s=[];for(n=0,r=i.length;n<r;n++)t=i[n],t!=null&&s.push(t.call(this,e));return s},e}(),d={},d.sprite=function(){function e(){}return e.prototype.init=function(){var e,t,n,r;return this.image||b(2,"Sprite entitys require an image"),(e=this.x)==null&&(this.x=0),(t=this.y)==null&&(this.y=0),(n=this.angle)==null&&(this.angle=0),(r=this.opacity)==null&&(this.opacity=255),this.scaleFactor!=null?this.scale(this.scaleFactor,this.pixel):this._recalculateImage()},e.prototype.draw=function(){var e;return d=this.parent.context,e=w.round,d.save(),d.translate(e(this.x-this.xOffset),e(this.y-this.yOffset)),d.rotate(this.angle*Math.PI/180),d.globalAlpha=this.opacity,d.drawImage(this.image,0,0,this.width,this.height),d.restore()},e.prototype.scale=function(e,t){return this.scaleFactor=e,this.pixel=t,this.y-=this.height*this.scaleFactor[1]/2,this.image=g.scale(this.image,this.scaleFactor,this.pixel),this._recalculateImage()},e.prototype.rect=function(){return{x:this.x-this.xOffset,y:this.y-this.yOffset,width:this.width,height:this.height}},e.prototype._recalculateImage=function(){return this.width=this.image.width,this.height=this.image.height,this.xOffset=w.round(this.width/2),this.yOffset=w.round(this.height/2)},e}(),d.move=function(){function e(){}return e.prototype.init=function(){return this["import"](["sprite"])},e.prototype.move=function(e,t){return this.x+=e,this.y+=t},e.prototype.moveTo=function(e,t){this.x=e,this.y=t},e}(),d.tile=function(){function e(){}return e.prototype.init=function(){return this["import"](["sprite"])},e.prototype.move=function(e,t){return x.remove(this.tile.contents,this),this.x+=e,this.y+=t,this.tile.parent.place(this)},e.prototype.moveTo=function(e,t){return this.x=e,this.y=t,x.remove(this.tile.contents,this),this.tile.parent.place(this)},e.prototype.rect=function(){return{x:this.res[0]*this.x-this.xOffset,y:this.res[1]*this.y-this.yOffset,width:this.width,height:this.height}},e}(),d.collide=function(){function e(){}return e.prototype.init=function(){return N.call(this.components,"layer")<0&&this["import"](["sprite"]),this.solid=N.call(this.components,"physics")>=0?!1:!0},e.prototype.findCollisions=function(){var e,t,n,r,i;n=this.parent.find(["collide"],this),this.colliding=[];for(r=0,i=n.length;r<i;r++)t=n[r],e=this.collide(t),e&&(this.emit("hit",e),this.colliding.push(e));return this.colliding},e.prototype.move=function(e,t){return this.x+=e,this.y+=t,this.findCollisions().length>0?(this.x-=e,this.y-=t,Math.abs(e)<1&&Math.abs(t)<1?!1:this.move(~~(e/2),~~(t/2))?this.move(~~(e/2),~~(t/2))?!0:!1:!1):!0},e}(),d.layer=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return k(t,e),t.prototype.init=function(){var e,t,n,r,i,s,o,u,a,f,l;return(e=this.width)==null&&(this.width=this.image.width),(t=this.height)==null&&(this.height=this.image.height),(r=this.x)==null&&(this.x=0),(i=this.y)==null&&(this.y=0),(s=this.opacity)==null&&(this.opacity=255),(o=this.angle)==null&&(this.angle=0),this.xOffset=this.yOffset=0,this.scaleFactor&&this.scale(this.scaleFactor),(u=this.repeatX)==null&&(this.repeatX=!1),(a=this.repeatY)==null&&(this.repeatY=!1),(f=this.scrollY)==null&&(this.scrollY=!1),(l=this.scrollX)==null&&(this.scrollX=!0),(n=this.speed)!=null?n:this.speed=0},t.prototype.draw=function(e,t){var n,r;e==null&&(e=0),t==null&&(t=0),r=this.parent.rect(),n=w.round,e>0||t>0||(this.scrollX&&(this.x=w.round(r.x*this.speed)),this.scrollY&&(this.y=w.round(r.y*this.speed))),d=this.parent.context,d.save(),d.rotate(this.angle*Math.PI/180),d.globalAlpha=this.opacity,d.translate(n(this.x+e),n(this.y+t)),d.drawImage(this.image,0,0,this.width,this.height),d.restore(),this.repeatX&&this.x+this.width+e<r.x+r.width&&this.draw(e+this.width,0);if(this.repeatY&&this.y+this.height+t<r.y+r.height)return this.draw(0,t+this.height)},t}(d.sprite),d.tween=function(){function e(){}return e.prototype.init=function(){return this.tweening=!1,this.tweens=[],this.updates.push(function(){var e,t,n,r,i;r=this.tweens,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],e.run()?i.push(void 0):i.push(x.remove(this.tweens,e));return i})},e.prototype.tween=function(e,t,n){return this.tweens.push(new c(this,e,t,n)),this},e}(),c=function(){function e(e,t,n,r,i){var s,o,u;this.en=e,this.props=t,this.cb=i,this.func=r||function(e,t,n,r){return t+n*(e/r)},this.d=n*60,this.t=0,this.b={},this.c={},u=this.props;for(s in u)o=u[s],!isNaN(o)&&!isNaN(this.en[s])?(this.c[s]=o-this.en[s],this.b[s]=this.en[s]):b(2,"Cannot tween "+s+" as only numerics can be tweened")}return e.prototype.run=function(){var e,t,n;n=this.c;for(e in n)t=n[e],this.en[e]=this.func(this.t,this.b[e],this.c[e],this.d);return this.t++===this.d?(this.cb!=null&&this.cb(),!1):!0},e}(),E={},T={},p={},E.behavior=p,E.intergrate=y=function(e,t){var n;if(e.still())return;return n=[],T.scale(e.acc,1e4/e.mass,e.acc),T.add(T.scale(e.vel,t,[]),T.scale(e.acc,.5*t*t,[]),n),T.add(e.vel,T.scale(e.acc,t,[]),e.vel),e.move(n[0],n[1]),T.scale(e.vel,1-e.friction/5,e.vel),e.acc=[0,0]},S=Math.sqrt,T.add=function(e,t,n){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n},T.sub=function(e,t,n){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n},T.dir=function(e,t,n){var r,i,s;return r=t[0]-e[0],i=t[1]-e[1],s=1/S(r*r+i*i),n[0]=r*s,n[1]=i*s,n},T.scale=function(e,t,n){return n[0]=e[0]*t,n[1]=e[1]*t,n},T.proj=function(e,t,n){var r;return r=(e[0]*t[0]+e[1]*t[1])/(t[0]*t[0]+t[1]*t[1]),n[0]=r*t[0],n[1]=r*t[1],n},T.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},T.cross=function(e,t){return e[0]*t[0]-e[1]*t[1]},T.dist=function(e,t){var n,r;return n=t[0]-e[0],r=t[1]-e[1],S(n*n+r*r)},T.distSq=function(e,t){var n,r;return n=t[0]-e[0],r=t[1]-e[1],n*n+r*r},T.norm=function(e,t){var n;return n=S(e[0]*e[0]+e[1]*e[1]),t[0]=e[0]/n,t[1]=e[1]/n,t},T.clone=function(e,t){return t=e.slice(0)},T.neg=function(e,t){return t[0]=-e[0],t[1]=-e[1](t)},T.mag=function(e){return S(e[0]*e[0]+e[1]*e[1])},T.magSq=function(e){return e[0]*e[0]+e[1]*e[1]},d.physics=function(){function e(){}return e.prototype.init=function(){var e,t,n,r,i;return this["import"](["move","collide"]),(e=this.behavior)==null&&(this.behavior=[]),this.updates.push(function(e){var t,n,r,i;i=this.behavior;for(n=0,r=i.length;n<r;n++)t=i[n],t!=null&&t.call(this,e);return this.intergrate(e)}),(t=this.vel)==null&&(this.vel=[0,0]),(n=this.acc)==null&&(this.acc=[0,0]),this.old={},(r=this.friction)==null&&(this.friction=0),(i=this.mass)==null&&(this.mass=1),this.on("hit",function(e){if(e.e2.solid)return e.dir==="left"||e.dir==="right"?this.vel[0]=0:this.vel[1]=0})},e.prototype.intergrate=function(e){var t,n;t=0,n=[];while(t++<8)n.push(y(this,e/8));return n},e.prototype.still=function(){return this.vel[0]===0&&this.vel[1]===0&&this.acc[0]===0&&this.acc[1]===0},e}(),p.gravity=function(){if(this.acc[1]<9.8){this.acc[1]++;if(this.acc[1]>9.8)return this.acc[1]=9.8}},l=function(){function e(e){var t,n,r,i,s,o,u,a,f;e==null&&(e={}),this.x=e.x||0,this.y=e.y||0,this.res=e.res||[32,32],this.size=e.size||[100,100],this.parent=e.parent,e.name&&(this.name=e.name),this.width=this.size[0]*this.res[0],this.height=this.size[1]*this.res[1],this.components=[],this.tiles=function(){var e,t,n;n=[];for(s=e=0,t=this.size[0];0<=t?e<t:e>t;s=0<=t?++e:--e)n.push(function(){var e,t,n;n=[];for(i=e=0,t=this.size[1];0<=t?e<t:e>t;i=0<=t?++e:--e)n.push({parent:this});return n}.call(this));return n}.call(this),r={s:[0,1],e:[1,0],n:[0,-1],w:[-1,0]};for(s=o=0,a=this.size[1];0<=a?o<a:o>a;s=0<=a?++o:--o)for(i=u=0,f=this.size[0];0<=f?u<f:u>f;i=0<=f?++u:--u){this.tiles[i][s].x=i,this.tiles[i][s].y=s,this.tiles[i][s].content=[];for(n in r)t=r[n],this.tiles[i][s][n]=this.tiles[i+t[0]]!=null&&this.tiles[i+t[0]][s+t[1]]!=null?this.tiles[i+t[0]][s+t[1]]:null}}return e.prototype.place=function(e){var t=this;return e.forEach?e.forEach(function(e){return t.place(e)}):(this.parent.e.push(e),e.tile=this.tiles[e.x][e.y],e.parent=this.parent,this.tiles[e.x][e.y].content.unshift(e),e.x=e.x*this.res[0]+this.x,e.y=e.y*this.res[1]+this.y)},e.prototype.lookup=function(e,t){return this.tiles[e][t].content},e.prototype.clear=function(){var e,t,n,r,i,s;i=this.tiles,s=[];for(n=0,r=i.length;n<r;n++)e=i[n],s.push(function(){var n,r,i;i=[];for(n=0,r=e.length;n<r;n++)t=e[n],i.push(t.content=[]);return i}());return s},e.prototype.atRect=function(e){var t,n,r,i,s,o,a,f,l,c,h;n=[],t=u.math.round,i=t(e.x/this.res[0]),a=t(e.y/this.res[1]),s=t((e.x+e.width)/this.res[0]),f=t((e.y+e.height)/this.res[1]);for(o=l=a;a<=f?l<=f:l>=f;o=a<=f?++l:--l)for(r=c=i;i<=s?c<=s:c>=s;r=i<=s?++c:--c)((h=this.tiles[r])!=null?h[o]:void 0)!=null&&n.push(this.tiles[r][o].content);return n},e.prototype.rect=function(){return this},e}(),s=function(){function h(e){var n,r=this;this.context=e,n=function(e){var n,r,i;return e=e||window.event,e.type==="keyup"?(r=!1,n=o):(r=!0,n=t),s[e.keyCode]=r,(i=e.keyCode,N.call(n,i)>=0)&&n[e.keyCode](),e.preventDefault()},this.context.onkeydown=this.context.onkeyup=n}var e,t,n,r,i,s,o,a,f,l,c;h.prototype.press=function(e,n){var i,s,o,a;if(e.forEach){a=[];for(s=0,o=e.length;s<o;s++)i=e[s],a.push(this.press(i,n));return a}return r[e]!=null?t[r[e]]=n:u.log(3,"invalid key: "+e)},h.prototype.release=function(e,t){var n,i,s,a;if(e.forEach){a=[];for(i=0,s=e.length;i<s;i++)n=e[i],a.push(this.release(n,t));return a}return r[e]!=null?o[r[e]]=t:u.log(3,"invalid key: "+e)},h.prototype.pressed=function(e){return r[e]!=null?s[r[e]]:u.log(3,"invalid key: "+e)},t=[],o=[],s=[],r={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,"delete":46,leftwin:91,rightwin:92,multiply:106,add:107,subtract:109,decimalpoint:110,divide:111,numlock:144,scrollock:145,semicolon:186,equals:187,comma:188,dash:189,period:190,forwardslash:191,backtick:192,openbracket:219,backslash:220,closebracket:221,quote:222};for(i=a=0;a<10;i=++a)r[""+i]=48+i,r["numpad"+i]=96+i,r["f"+i]=112+i;c="abcdefghijklmnopqrstuvwxyz";for(n=f=0,l=c.length;f<l;n=++f)e=c[n],r[e]=65+n;return h}(),o=function(){function e(e){var t,n,r,i,s,o,u,a,f,l,c,h=this;this.context=e,this.context.oncontextmenu=function(){return!1},r=["left","middle","right"],n=["click","down","up"],s=function(e){return h.x=e.offsetX,h.y=e.offsetX};for(o=0,f=r.length;o<f;o++){p=r[o],this[p]={};for(u=0,l=n.length;u<l;u++)t=n[u],this[p][t]=function(){}}for(a=0,c=n.length;a<c;a++)t=n[a],i=t==="click"?"onclick":"onmouse"+t,this.context[i]=function(e){return h[r[e.button]][e.type.replace("mouse","")](e),e.preventDefault()};this.context.onmousemove=s}return e}(),v={AABB:function(e,t){var n,r,i,s,o,u,a,f,l;return f=(e.width+t.width)/2,s=(e.height+t.height)/2,r=e.x+e.width/2-(t.x+t.width/2),i=e.y+e.height/2-(t.y+t.height/2),Math.abs(r)<=f&&Math.abs(i)<=s?(l=f*i,o=s*r,l>o?l>-o?n="top":n="left":l>-o?n="right":n="bottom",u=f-(r<0?-r:r),a=s-(i<0?-i:i),{dir:n,pv:[r<0?-u:u,i<0?-a:a]}):!1},hitTest:function(e,t){return this.AABB({x:e[0],y:e[1],width:1,height:1},t)},AABBhitmap:function(e,t){var n,r,i,s,o,u;if(!v.AABB(e,t.rect()))return!1;u=t.hitmap;for(n in u){i=u[n];for(s=0,o=i.length;s<o;s++){r=i[s],n=this.hitTest([t.x+r[0],t.y+r[1]],e);if(n)return n}}return!1},createHitmap:function(e,t){var n,r,i,s,o,u;t==null&&(t=2),i=g.edgeDetect(e,t),n={left:[],right:[],up:[],down:[]};for(s=0,o=i.length,u=t;s<o;s+=u)r=i[s],n[r[2]].push([r[0],r[1]]);return n}},d.AABB=function(){function e(){}return e.prototype.type="AABB",e.prototype.collide=function(e){var t,n=this;return e.forEach&&e.forEach(function(e){return n.collide(e)}),e.type===this.type?(t=v.AABB(this.rect(),e.rect()),t.e1=this,t.e2=e,t):e.type==="hitmap"?v.AABBhitmap(this.rect(),e):!1},e}(),d.hitmap=function(){function e(){}return e.prototype.type="hitmap",e.prototype.init=function(){return this._recalculateImage()},e.prototype._recalculateImage=function(){return this.width=this.image.width,this.height=this.image.height,this.xOffset=w.round(this.width/2),this.yOffset=w.round(this.height/2),this.hitmap=v.createHitmap(this.image)},e.prototype.collide=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,m=this;e.forEach&&e.forEach(function(e){return m.collide(e)});if(!v.AABB(this.rect(),e.rect()))return!1;if(e.type===this.type){p=e.hitmap;for(t in p){s=p[t];for(u=0,l=s.length;u<l;u++){r=s[u],d=this.hitmap;for(o=a=0,c=d.length;a<c;o=++a){n=d[o];for(f=0,h=o.length;f<h;f++){i=o[f];if(r[0]+e.x===i[0]+this.x&&r[1]+e.y===i[1]+this.y)return!0}}}}return!1}if(e.type==="AABB")return v.AABBhitmap(e.rect(),this)},e}(),d.polygon=function(){function e(){}return e.prototype.type="polygon",e.prototype.init=function(){if(!this.points)return b(2,"Polygons must have points!")},e}(),r=function(){function e(e){var t,n,r;this.options=e!=null?e:{},this.options.canvas!=null&&(this.canvas=document.getElementById(e.canvas)),this.canvas==null&&(this.canvas=x.canvas(),document.body.appendChild(this.canvas)),this.canvas.tabIndex=1,this.width=this.canvas.width=(t=this.options.width)!=null?t:400,this.height=this.canvas.height=(n=this.options.height)!=null?n:300,this.showFPS=(r=this.options.fps)!=null?r:!1,this.canvas.x=this.canvas.y=0,this.context=this.canvas.getContext("2d")}return e.prototype.start=function(e){var t,n;return t=(n=this.options.loadingScreen)!=null?n:function(){},this.switchState(e)},e.prototype.switchState=function(e){return this.e=[],this.loop&&this.loop.stop(),this.oldState=this.state,this.state=e,this.state.setup.call(this.state,this),this.loop=new i(this,this.showFPS),this.loop.add([this.state.update,this.state.draw]),this.loop.start()},e.prototype.clear=function(){return this.context.clearRect(0,0,this.width,this.height)},e.prototype.find=function(e,t){return m.call(this,e,t)},e}(),i=function(){function e(e,t){this.parent=e,this.showFPS=t,this.loop=L(this.loop,this),this.fps=0,this.averageFPS=new a(20),this.call=[]}return e.prototype.start=function(){var e,t,n;return this.paused=this.stopped=!1,t=e=n=(new Date).getTime(),u.ticker.call(window,this.loop)},e.prototype.loop=function(){var e,t,n,r;this.currentTick=(new Date).getTime(),this.dt=this.currentTick-this.lastTick||17,this.fps=this.averageFPS.add(1e3/this.dt);if(!this.stopped&&!this.paused){this.dt>20&&(this.dt=17),r=this.call;for(t=0,n=r.length;t<n;t++)e=r[t],e.call(this.parent,this.dt/1e3)}return this.stopped||u.ticker.call(window,this.loop),this.showFPS&&this.parent.context.fillText("fps:"+this.fps+" step:"+this.dt,10,10),this.lastTick=this.currentTick},e.prototype.pause=function(){return this.paused=!0},e.prototype.stop=function(){return this.stopped=!0},e.prototype.add=function(e){return this.call=this.call.concat(e)},e}(),a=function(){function e(e){this.size=e,this.values=new Array(this.size),this.count=0}return e.prototype.add=function(e){return this.values=this.values.slice(1,this.size),this.values.push(e),this.count<this.size&&this.count++,this.values.reduce(function(e,t){return e+t})/this.count|0},e}(),h=function(){function e(e){this.options=e,this.parent=this.options.parent,this.canvas=this.options.canvas||this.parent.canvas||x.canvas(),this.context=this.canvas.getContext("2d"),this.width=this.options.width||this.canvas.width,this.height=this.options.height||this.canvas.height,this.viewWidth=this.options.viewWidth||this.width,this.viewHeight=this.options.viewHeight||this.height,this.viewX=this.options.viewX||0,this.viewY=this.options.viewY||0,this.x=this.options.x||0,this.y=this.options.y||0,this.e=[],this.updates=[]}return e.prototype.add=function(e){var t=this;if(e.forEach)return e.forEach(function(e){return t.add(e)});e.parent=this,this.e.push(e),this.parent.e.push(e);if(e.name!=null)return this[e.name]=e},e.prototype.update=function(e){var t,n,r,i,s,o,u,a,f;u=this.e;for(r=0,s=u.length;r<s;r++)t=u[r],this.close(t)&&t.update!=null&&t.update(e);a=this.updates,f=[];for(i=0,o=a.length;i<o;i++)n=a[i],n!=null&&f.push(n.call(this,e));return f},e.prototype.draw=function(){var e,t,n,r;this.context.save(),this.context.translate(-this.viewX,-this.viewY),this.context.beginPath(),this.context.rect(this.x+this.viewX,this.y+this.viewY,this.width,this.height),this.context.clip(),r=this.e;for(t=0,n=r.length;t<n;t++)e=r[t],this.visible(e)&&e.draw!=null&&e.draw();return this.context.restore()},e.prototype.move=function(e,t){return this.viewX+=e,this.viewY+=t,this.keepInBounds()},e.prototype.moveTo=function(e,t){return this.viewX=e,this.viewY=t,this.keepInBounds()},e.prototype.follow=function(e){return this.viewX=e.x-w.round(this.width/2),this.viewY=e.y-w.round(this.height/2),this.keepInBounds()},e.prototype.forceInside=function(e,t){var n,r;t==null&&(t=0),r=this.viewWidth,n=this.viewHeight,e.x<t&&(e.x=t),e.y<t&&(e.y=t),e.x>r-t&&(e.x=r-t);if(e.y>n-t)return e.y=n-t},e.prototype.rect=function(){return{width:this.width,height:this.height,x:this.viewX,y:this.viewY}},e.prototype.visible=function(e){return v.AABB(e.rect(),this.rect())},e.prototype.keepInBounds=function(){this.viewX<0&&(this.viewX=0),this.viewY<0&&(this.viewY=0),this.viewX+this.width>this.viewWidth&&(this.viewX=this.viewWidth-this.width);if(this.viewY+this.height>this.viewHeight)return this.viewY=this.viewHeight-this.height},e.prototype.find=function(e,t){return m.call(this,e,t)},e.prototype.close=function(e){return v.AABB(e.rect(),{width:this.width*2,height:this.height*2,x:this.viewX-this.width/2,y:this.viewY-this.height/2})},e}(),b=function(){var e,t,n;n=arguments[0],e=2<=arguments.length?A.call(arguments,1):[];if(n<=u.loglevel){switch(n){case 1:t=console.error||console.log;break;case 2:t=console.warn||console.log;break;case 3:t=console.info||console.log;break;case 4:t=console.debug||console.log}return t.call.apply(t,[console,"(Rogue)"].concat(A.call(e)))}return},x={canvas:function(){return document.createElement("canvas")},imgToCanvas:function(e){var t;return d=this.canvas(),d.src=e.src,d.width=e.width,d.height=e.height,t=d.getContext("2d"),t.drawImage(e,0,0,e.width,e.height),d},isArray:function(e){return Object.prototype.toString.call(e)==="[object Array]"},remove:function(e,t){var n;return n=e.indexOf(t),n&&e.splice(n,1)},mixin:function(e,t){var n,r;for(r in t)n=t[r],n!==null&&(n.slice?e[r]=n.slice(0):e[r]=n);return e},IE:function(){return},eventer:function(e){return e.handlers={},e.on=function(e,t){var n,r;return((r=(n=this.handlers)[e])!=null?r:n[e]=[]).push(t)},e.off=function(e,t){return this.handlers[e]&&x.remove(this.handlers[e],t)},e.emit=function(){var e,t,n;return t=arguments[0],e=2<=arguments.length?A.call(arguments,1):[],this.handlers[t]&&function(){var r,i,s,o;s=this.handlers[t],o=[];for(r=0,i=s.length;r<i;r++)n=s[r],o.push(n.call.apply(n,[this].concat(A.call(e))));return o}.call(this)},e}},m=function(e,t){var n,r,i,s,o,u,a,f,l;i=[],l=this.e;for(o=0,a=l.length;o<a;o++){n=l[o];if(n===t)continue;r=0;for(u=0,f=e.length;u<f;u++)s=e[u],N.call(n.components,s)>=0&&r++;r===e.length&&i.push(n)}return i},w={round:function(e){return.5+e|0}},w.vector=T,u=this.Rogue={},typeof module!="undefined"&&module!==null&&(module.exports=u),u.ticker=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return window.setTimeout(e,1e3/60)},u.ready=function(e){return document.addEventListener("DOMContentLoaded",function(){return document.removeEventListener("DOMContentLoaded",arguments.callee,!1),e()})},u.log=b,u.util=x,u.math=w,u.physics=E,u.Game=r,u.GameLoop=i,u.TileMap=l,u.AssetManager=t,u.SpriteSheet=f,u.gfx=g,u.collision=v,u.Animation=e,u.ViewPort=h,u.components=d,u.Entity=n,u.Keyboard=s,u.Mouse=o,u.loglevel=4}).call(this);