(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g=Array.prototype.indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},y=Object.prototype.hasOwnProperty,b=function(e,t){function r(){this.constructor=e}for(var n in t)y.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},w=function(e,t){return function(){return e.apply(t,arguments)}},E=Array.prototype.slice;p={},p.scale=function(e,t){var n;return n=e.getContext("2d"),n.mozImageSmoothingEnabled?n.mozImageSmoothingEnabled=!1:(n.scale(t,t),n.fillStyle=n.createPattern(e,"repeat"),n.fillRect(0,0,e.width,e.height)),e.width*=t,e.height*=t,e},t=function(){function e(){this.count=0,this.ecount=0,this.queue=[],this.assets={},this.filetypes={image:["png","gif","jpg","jpeg","tiff"],sound:["mp3","ogg"]}}return e.prototype.add=function(e){return this.queue=this.queue.concat(e)},e.prototype.get=function(e){return this.assets[e]==null&&o.log(2,"asset not loaded: "+e),this.assets[e]},e.prototype.loadAll=function(e){var t,n,r,i,s;this.onFinish=e.onFinish,this.onLoad=e.onLoad,i=this.queue,s=[];for(n=0,r=i.length;n<r;n++)t=i[n],s.push(this.load(t));return s},e.prototype.load=function(e){var t,n,r,i,s,u,a;i=this,n=e.split(".").pop(),a=this.filetypes;for(r in a)u=a[r],g.call(u,n)>=0&&(s=r);if(s==null){o.log(2,"unknown extension on: "+e);return}switch(s){case"image":return t=new Image,t.addEventListener("load",function(){var t,n;return t=m.canvas(),t.width=this.width,t.height=this.height,t.src=e,n=t.getContext("2d"),n.drawImage(this,0,0,this.width,this.height),i.count++,i.loaded(t)}),t.addEventListener("error",function(){return i.ecount++,o.log(2,"could not load asset: "+this.src),i.loaded(this)}),t.src=e}},e.prototype.loaded=function(e){var t;this.assets[e.src]=e,t=(this.count+this.ecount)/this.queue.length*100,this.onLoad(t);if(t===100)return this.onFinish()},e}(),a=function(){function e(e){var t,n,r,i,s,o,u,a;this.options=e,this.img=this.options.image,this.res=this.options.res||[32,32],this.length=0;for(r=0,s=this.img.width,o=this.res[0];0<=s?r<s:r>s;r+=o)for(i=0,u=this.img.height,a=this.res[1];0<=u?i<u:i>u;i+=a)t=m.canvas(),n=t.getContext("2d"),t.width=this.res[0],t.height=this.res[1],n.drawImage(this.img,r,i,t.width,t.height,0,0,t.width,t.height),this[this.length]=t,this.length++}return e}(),e=function(){function e(e){this.options=e,this.sprites=this.options.spritesheet,this.speed=this.options.speed||6,this.i=this.options.start||0,this.t=0,this.loop=this.options.loop||!0,this.bounce=this.options.bounce||!1,this.onFinish=this.options.onFinish,this.dir=1,this.frame=this.sprites[this.i]}return e.prototype.next=function(){return this.t===this.speed&&(this.frame=this.sprites[this.i+=this.dir],this.t=0),this.i===this.sprites.length-1&&(this.loop?this.bounce?this.dir=-1:this.i=0:this.onFinish&&this.onFinish()),this.i===0&&this.dir===-1&&(this.dir=1),this.t++,this.frame},e}(),n=function(){function e(e){this.options=e,this.components=[],this.updates={},m.mixin(this,this.options),this.require&&this["import"](this.require),this.parent&&this.parent.e.push(this)}return e.prototype["import"]=function(e){return m["import"](this,e)},e.prototype.update=function(){var e,t,n,r;n=this.updates,r=[];for(t in n)e=n[t],r.push(e.call(this));return r},e}(),c={},c.sprite=function(){function e(){}return e.prototype.init=function(){return this.image||d(2,"Sprite entitys require an image"),this.x==null&&(this.x=0),this.y==null&&(this.y=0),this.scaleFactor!=null?this.scale(this.scaleFactor,this.pixel):this._recalculateImage(),this.updates[99]=this.draw},e.prototype.draw=function(){var e,t;return c=this.parent.context,t=v.round,c.save(),c.translate(t(this.x-this.xOffset),t(this.y-this.yOffset)),m.isArray(e=this.scaleFactor)&&c.scale(e[0],e[1]),this.angle&&c.rotate(this.angle*Math.PI/180),this.alpha&&(c.globalAlpha=this.alpha),c.drawImage(this.image,0,0,this.width,this.height),c.restore()},e.prototype.scale=function(e,t){return t?this.image=p.scale(this.image,e):this.scaleFactor=e,this._recalculateImage()},e.prototype.rect=function(){return{x:this.x-this.xOffset,y:this.y-this.yOffset,width:this.width,height:this.height}},e.prototype._recalculateImage=function(){var e,t;return this.width==null&&(this.width=this.image.width*(((e=this.scaleFactor)!=null?e[0]:void 0)!=null||1)),this.height==null&&(this.height=this.image.height*(((t=this.scaleFactor)!=null?t[1]:void 0)!=null||1)),this.xOffset=v.round(this.width/2),this.yOffset=v.round(this.height/2)},e}(),c.move=function(){function e(){}return e.prototype.init=function(){return this["import"](["sprite"]),this.dy==null&&(this.dy=0),this.dx==null&&(this.dx=0),this.updates[97]=function(){return this.move(v.round(this.dx),v.round(-this.dy))}},e.prototype.move=function(e,t){return this.x+=e,this.y+=t},e.prototype.moveTo=function(e,t){this.x=e,this.y=t},e}(),c.tile=function(){function e(){}return e.prototype.init=function(){return this["import"](["sprite"])},e.prototype.move=function(e,t){return m.remove(this.tile.contents,this),this.x+=e,this.y+=t,this.tile.parent.place(this)},e.prototype.moveTo=function(e,t){return this.x=e,this.y=t,m.remove(this.tile.contents,this),this.tile.parent.place(this)},e.prototype.rect=function(){return{x:this.res[0]*this.x-this.xOffset,y:this.res[1]*this.y-this.yOffset,width:this.width,height:this.height}},e}(),c.collide=function(){function e(){}return e.prototype.init=function(){return this["import"](["sprite"])},e.prototype.collide=function(e){var t=this;return e.forEach&&e.forEach(function(e){return t.collide(e)}),m.collide(this.rect(),e.rect())},e.prototype.colliding=function(){var e,t,n,r,i;n=this.parent.find(["collide"]),m.remove(n,this),t=[];for(r=0,i=n.length;r<i;r++)e=n[r],this.collide(e)&&t.push(e);return t},e.prototype.move=function(e,t){var n;this.x+=e,this.y+=t,n=[];while(this.colliding().length>0)e!==0&&(e>0?this.x--:this.x++),t!==0?n.push(t>0?this.y--:this.y++):n.push(void 0);return n},e}(),c.collidePixel=function(){function e(){}return e.prototype.init=function(){return this["import"](["sprite"])},e.prototype.collide=function(e){},e}(),c.layer=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return b(t,e),t.prototype.init=function(){return this.width==null&&(this.width=this.image.width),this.height==null&&(this.height=this.image.height),this.x==null&&(this.x=0),this.y==null&&(this.y=0),this.scaleFactor&&this.scale(this.scaleFactor),this.repeatX==null&&(this.repeatX=!1),this.repeatY==null&&(this.repeatY=!1),this.scrollY==null&&(this.scrollY=!1),this.scrollX==null&&(this.scrollX=!0),this.speed==null&&(this.speed=0),this.updates[99]=this.draw},t.prototype.draw=function(e,t){var n,r;e==null&&(e=0),t==null&&(t=0),r=this.parent.rect(),n=v.round,e>0||t>0||(this.scrollX&&(this.x=r.x*this.speed|0),this.scrollY&&(this.y=r.y*this.speed|0)),c=this.parent.context,c.save(),this.angle&&c.rotate(this.angle*Math.PI/180),this.alpha&&(c.globalAlpha=this.alpha),c.translate(n(this.x+e),n(this.y+t)),c.drawImage(this.image,0,0,this.width,this.height),c.restore(),this.repeatX&&this.x+this.width+e<r.x+r.width&&this.draw(e+this.width,0);if(this.repeatY&&this.y+this.height+t<r.y+r.height)return this.draw(0,t+this.height)},t}(c.sprite),c.gravity=function(){function e(){}return e.prototype.init=function(){return this["import"](["move"]),this.gravity==null&&(this.gravity=-10),this.updates[96]=function(){if(this.dy>this.gravity)return this.dy-=1}},e}(),f=function(e){function t(e){var t,n,r,i,s,o,u;e==null&&(e={}),this.x=e.x||0,this.y=e.y||0,this.res=e.res||[32,32],this.size=e.size||[100,100],this.width=this.size[0]*this.res[0],this.height=this.size[1]*this.res[1],this.parent=e.parent,this.components=[],this.tiles=function(){var e,t;t=[];for(s=0,e=this.size[0];0<=e?s<e:s>e;0<=e?s++:s--)t.push(function(){var e,t;t=[];for(i=0,e=this.size[1];0<=e?i<e:i>e;0<=e?i++:i--)t.push({parent:this});return t}.call(this));return t}.call(this),this.updates={99:this.draw},r={s:[0,1],e:[1,0],n:[0,-1],w:[-1,0]};for(s=0,o=this.size[1];0<=o?s<o:s>o;0<=o?s++:s--)for(i=0,u=this.size[0];0<=u?i<u:i>u;0<=u?i++:i--){this.tiles[i][s].x=i,this.tiles[i][s].y=s,this.tiles[i][s].content=[];for(n in r)t=r[n],this.tiles[i][s][n]=this.tiles[i+t[0]]!=null&&this.tiles[i+t[0]][s+t[1]]!=null?this.tiles[i+t[0]][s+t[1]]:null}}return b(t,e),t.prototype.place=function(e){var t=this;return e.forEach?e.forEach(function(e){return t.place(e)}):(this.parent.e.push(e),m["import"](["tile"],e),e.tile=this.tiles[e.x][e.y],e.parent=this.parent,this.tiles[e.x][e.y].content.unshift(e),e.x=e.x*this.res[0]+this.x,e.y=e.y*this.res[1]+this.y)},t.prototype.lookup=function(e,t){return this.tiles[e][t].content},t.prototype.clear=function(){var e,t,n,r,i,s;i=this.tiles,s=[];for(n=0,r=i.length;n<r;n++)e=i[n],s.push(function(){var n,r,i;i=[];for(n=0,r=e.length;n<r;n++)t=e[n],i.push(t.content=[]);return i}());return s},t.prototype.atRect=function(e){var t,n,r,i,s,u,a,f,l;n=[],t=o.math.round,i=t(e.x/this.res[0]),a=t(e.y/this.res[1]),s=t((e.x+e.width)/this.res[0]),f=t((e.y+e.height)/this.res[1]);for(u=a;a<=f?u<=f:u>=f;a<=f?u++:u--)for(r=i;i<=s?r<=s:r>=s;i<=s?r++:r--)((l=this.tiles[r])!=null?l[u]:void 0)!=null&&n.push(this.tiles[r][u].content);return n},t.prototype.draw=function(){var e,t,n,r,i,s;n=this.atRect({x:this.parent.x?this.parent.x-this.x:0,y:this.parent.y?this.parent.y-this.y:0,width:this.parent.width,height:this.parent.height}),s=[];for(r=0,i=n.length;r<i;r++)t=n[r],s.push(function(){var n,r,i;i=[];for(n=0,r=t.length;n<r;n++)e=t[n],i.push(e.draw());return i}());return s},t.prototype.rect=function(){return this},t}(n),s=function(){function l(e){var n,r=this;this.context=e,this.context.oncontextmenu=function(){return!1},n=function(e){var n,i,o;e=e||window.event;if(e.target!==r.context)return;return e.type==="keyup"?(i=!1,n=u):(i=!0,n=t),s[e.keyCode]=i,(o=e.keyCode,g.call(n,o)>=0)&&n[e.keyCode](),e.preventDefault()},window.addEventListener("keyup",n,!1),window.addEventListener("keydown",n,!1)}var e,t,n,r,i,s,u,a,f;l.prototype.press=function(e,n){var i,s,u,a;if(e.forEach){a=[];for(s=0,u=e.length;s<u;s++)i=e[s],a.push(this.press(i,n));return a}return r[e]!=null?t[r[e]]=n:o.log(3,"invalid key: "+e)},l.prototype.release=function(e,t){var n,i,s,a;if(e.forEach){a=[];for(i=0,s=e.length;i<s;i++)n=e[i],a.push(this.release(n,t));return a}return r[e]!=null?u[r[e]]=t:o.log(3,"invalid key: "+e)},l.prototype.pressed=function(e){return r[e]!=null?s[r[e]]:o.log(3,"invalid key: "+e)},t=[],u=[],s=[],r={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,"delete":46,leftwin:91,rightwin:92,multiply:106,add:107,subtract:109,decimalpoint:110,divide:111,numlock:144,scrollock:145,semicolon:186,equals:187,comma:188,dash:189,period:190,forwardslash:191,backtick:192,openbracket:219,backslash:220,closebracket:221,quote:222};for(i=0;i<10;i++)r[""+i]=48+i,r["numpad"+i]=96+i,r["f"+i]=112+i;f="abcdefghijklmnopqrstuvwxyz";for(n=0,a=f.length;n<a;n++)e=f[n],r[e]=65+n;return l}(),r=function(){function e(e){var t,n,r;this.options=e!=null?e:{},this.options.canvas!=null&&(this.canvas=document.getElementById(e.canvas)),this.canvas==null&&(this.canvas=m.canvas(),document.body.appendChild(this.canvas)),this.canvas.tabIndex=1,this.width=this.canvas.width=(t=this.options.width)!=null?t:400,this.height=this.canvas.height=(n=this.options.height)!=null?n:300,this.showFPS=(r=this.options.fps)!=null?r:!1,this.canvas.x=this.canvas.y=0,this.context=this.canvas.getContext("2d")}return e.prototype.start=function(e){var t,n;return t=(n=this.options.loadingScreen)!=null?n:function(){},this.switchState(e)},e.prototype.switchState=function(e){return this.e=[],this.loop&&this.loop.stop(),this.oldState=this.state,this.state=e,this.state.setup(),this.loop=new i(this.context,this.showFPS),this.loop.add(this.state.update),this.loop.start()},e.prototype.clear=function(){return this.context.clearRect(0,0,this.width,this.height)},e.prototype.find=function(e){return h.call(this,e)},e}(),i=function(){function e(e,t){this.ctx=e,this.showFPS=t,this.loop=w(this.loop,this),this.fps=0,this.averageFPS=new u(20),this.call=[]}return e.prototype.start=function(){var e,t,n;return this.paused=this.stopped=!1,t=e=n=(new Date).getTime(),o.ticker.call(window,this.loop)},e.prototype.loop=function(){var e,t,n,r;this.currentTick=(new Date).getTime(),this.tickDuration=this.currentTick-this.lastTick,this.fps=this.averageFPS.add(1e3/this.tickDuration);if(!this.stopped&&!this.paused){r=this.call;for(t=0,n=r.length;t<n;t++)e=r[t],e()}return this.stopped||o.ticker.call(window,this.loop),this.lastTick=this.currentTick},e.prototype.pause=function(){return this.paused=!0},e.prototype.stop=function(){return this.stopped=!0},e.prototype.add=function(e){return this.call=this.call.concat(e)},e}(),u=function(){function e(e){this.size=e,this.values=new Array(this.size),this.count=0}return e.prototype.add=function(e){return this.values=this.values.slice(1,this.size),this.values.push(e),this.count<this.size&&this.count++,parseInt(this.values.reduce(function(e,t){return e+t})/this.count)},e}(),l=function(e){function t(e){this.options=e,this.canvas=this.options.canvas||m.canvas(),this.context=this.canvas.getContext("2d"),this.parent=this.options.parent,this.width=this.options.width||this.canvas.width,this.height=this.options.height||this.canvas.height,this.viewWidth=this.options.viewWidth||this.width,this.viewHeight=this.options.viewHeight||this.height,this.viewX=this.options.viewX||0,this.viewY=this.options.viewY||0,this.x=this.options.x||0,this.y=this.options.y||0,this.e=[],this.updates={99:this.draw}}return b(t,e),t.prototype.add=function(e){var t=this;return e.forEach?e.forEach(function(e){return t.add(e)}):(e.parent=this,this.e.push(e),this.parent.e.push(e))},t.prototype.draw=function(){var e,t,n,r;this.context.save(),this.context.translate(-this.viewX,-this.viewY),this.context.beginPath(),this.context.rect(this.x+this.viewX,this.y+this.viewY,this.width,this.height),this.context.clip(),r=this.e;for(t=0,n=r.length;t<n;t++)e=r[t],this.visible(e)&&e.update();return this.context.restore()},t.prototype.move=function(e,t){return this.viewX+=e,this.viewY+=t,this.keepInBounds()},t.prototype.moveTo=function(e,t){return this.viewX=e,this.viewY=t,this.keepInBounds()},t.prototype.follow=function(e){return this.viewX=e.x-v.round(this.width/2),this.viewY=e.y-v.round(this.height/2),this.keepInBounds()},t.prototype.forceInside=function(e,t,n){var r,i;t==null&&(t=!1),n==null&&(n=0),t?(i=this.width,r=this.height):(i=this.viewWidth,r=this.viewHeight),e.x<n&&(e.x=n),e.y<n&&(e.y=n),e.x>i-n&&(e.x=i-n);if(e.y>r-n)return e.y=r-n},t.prototype.rect=function(){return{width:this.width,height:this.height,x:this.viewX,y:this.viewY}},t.prototype.visible=function(e){return m.collide(e.rect(),this.rect())},t.prototype.keepInBounds=function(){this.viewX<0&&(this.viewX=0),this.viewY<0&&(this.viewY=0),this.viewX+this.width>this.viewWidth&&(this.viewX=this.viewWidth-this.width);if(this.viewY+this.height>this.viewHeight)return this.viewY=this.viewHeight-this.height},t.prototype.find=function(e){return h.call(this,e)},t}(n),d=function(){var e,t,n;n=arguments[0],e=2<=arguments.length?E.call(arguments,1):[];if(n<=o.loglevel){switch(n){case 1:t=console.error||console.log;break;case 2:t=console.warn||console.log;break;case 3:t=console.info||console.log;break;case 4:t=console.debug||console.log}return t.call.apply(t,[console,"(Rogue)"].concat(E.call(e)))}return},m={canvas:function(){return document.createElement("canvas")},isArray:function(e){return Object.prototype.toString.call(e)==="[object Array]"},remove:function(e,t){return e.splice(e.indexOf(t),1)},collide:function(e,t){return!(t.x>=e.x+e.width||t.x+t.width<=e.x||t.y>=e.y+e.height||t.y+t.height<=e.y)},overlap:function(e,t){var n;return n=Math.max(e.x,t.x)},mixin:function(e,t){var n,r;for(r in t)n=t[r],n.slice?e[r]=n.slice(0):e[r]=n;return e},"import":function(e,t){var n,r,i,s;s=[];for(r=0,i=t.length;r<i;r++)n=t[r],g.call(e.components,n)<0?(e.components.push(n),m.mixin(e,new c[n]),e.init(),delete e.init,s.push(delete e["import"])):s.push(void 0);return s}},h=function(e){var t,n,r,i,s,o,u,a,f;r=[],f=this.e;for(s=0,u=f.length;s<u;s++){t=f[s],n=0;for(o=0,a=e.length;o<a;o++)i=e[o],g.call(t.components,i)>=0&&n++;n===e.length&&r.push(t)}return r},v={round:function(e){return.5+e|0}},o=this.Rogue={},typeof module!="undefined"&&module!==null&&(module.exports=o),o.ticker=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame,o.ready=function(e){return document.addEventListener("DOMContentLoaded",function(){return document.removeEventListener("DOMContentLoaded",arguments.callee,!1),e()})},o.log=d,o.util=m,o.math=v,o.Game=r,o.GameLoop=i,o.TileMap=f,o.AssetManager=t,o.SpriteSheet=a,o.gfx=p,o.Animation=e,o.ViewPort=l,o.components=c,o.Entity=n,o.KeyboardManager=s,o.loglevel=4}).call(this);